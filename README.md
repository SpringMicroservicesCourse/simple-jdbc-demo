# Spring JDBC Demo Project

這是一個展示 Spring JDBC 基本用法的示範專案。

## 功能特點

- 使用 Spring JDBC Template 進行數據庫操作
- 展示基本的 CRUD 操作
- 包含批量處理示例
- 使用 H2 內存數據庫

## 技術棧

- Java 17
- Spring Boot 3.4.5
- Spring JDBC
- H2 Database
- Lombok
- Maven

## 項目結構

```
src/main/java/tw/fengqing/spring/data/demo/
├── SimpleJdbcDemoApplication.java  # 應用程序入口
├── FooDao.java                     # 基本 JDBC 操作示例
├── BatchFooDao.java               # 批量操作示例
└── Foo.java                       # 數據模型

src/main/resources/
├── schema.sql                     # 數據庫表結構
└── data.sql                       # 初始數據
```

## 重要程式碼說明

### 1. 數據模型 (Foo.java)
```java
@Data
@Builder
public class Foo {
    private Long id;
    private String bar;
}
```

### 2. 基本 JDBC 操作 (FooDao.java)
```java
@Repository
public class FooDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcInsert simpleJdbcInsert;

    // 構造函數注入
    public FooDao(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
        this.simpleJdbcInsert = new SimpleJdbcInsert(jdbcTemplate)
                .withTableName("FOO")
                .usingGeneratedKeyColumns("ID");
    }

    // 插入數據示例
    public void insertData() {
        // 使用 JdbcTemplate 插入
        Arrays.asList("b", "c").forEach(bar -> {
            jdbcTemplate.update("INSERT INTO FOO (BAR) VALUES (?)", bar);
        });

        // 使用 SimpleJdbcInsert 插入
        HashMap<String, String> row = new HashMap<>();
        row.put("BAR", "d");
        Number id = simpleJdbcInsert.executeAndReturnKey(row);
    }

    // 查詢數據示例
    public void listData() {
        log.info("Count: {}", 
            jdbcTemplate.queryForObject("SELECT COUNT(*) FROM FOO", Long.class));
    }
}
```

### 3. 批量操作 (BatchFooDao.java)
```java
@Repository
public class BatchFooDao {
    private final JdbcTemplate jdbcTemplate;
    private final NamedParameterJdbcTemplate namedParameterJdbcTemplate;

    // 構造函數注入
    public BatchFooDao(JdbcTemplate jdbcTemplate, DataSource dataSource) {
        this.jdbcTemplate = jdbcTemplate;
        this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
    }

    // 批量插入示例
    public void batchInsert() {
        // 使用 BatchPreparedStatementSetter
        jdbcTemplate.batchUpdate("INSERT INTO FOO (BAR) VALUES (?)",
                new BatchPreparedStatementSetter() {
                    @Override
                    public void setValues(PreparedStatement ps, int i) throws SQLException {
                        ps.setString(1, "b-" + i);
                    }

                    @Override
                    public int getBatchSize() {
                        return 2;
                    }
                });

        // 使用 NamedParameterJdbcTemplate
        List<Foo> list = Arrays.asList(
            Foo.builder().id(100L).bar("b-100").build(),
            Foo.builder().id(101L).bar("b-101").build()
        );
        namedParameterJdbcTemplate.batchUpdate(
            "INSERT INTO FOO (ID, BAR) VALUES (:id, :bar)",
            SqlParameterSourceUtils.createBatch(list));
    }
}
```

### 4. 應用入口 (SimpleJdbcDemoApplication.java)
```java
@SpringBootApplication
@Slf4j
public class SimpleJdbcDemoApplication implements CommandLineRunner {
    @Autowired
    private FooDao fooDao;
    @Autowired
    private BatchFooDao batchFooDao;

    @Override
    public void run(String... args) throws Exception {
        fooDao.insertData();
        batchFooDao.batchInsert();
        fooDao.listData();
    }
}
```

## 快速開始

1. 確保已安裝 Java 17 和 Maven

2. 克隆專案
```bash
git clone <repository-url>
cd simple-jdbc-demo
```

3. 運行應用程序
```bash
mvn spring-boot:run
```

## 主要功能說明

1. 基本 JDBC 操作 (FooDao.java)
   - 插入數據
   - 查詢記錄數
   - 使用 SimpleJdbcInsert

2. 批量操作 (BatchFooDao.java)
   - 批量插入
   - 使用 NamedParameterJdbcTemplate

## 數據庫結構

```sql
CREATE TABLE FOO (
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BAR VARCHAR(64)
);
```

## 代碼亮點

1. **依賴注入最佳實踐**
   - 使用構造函數注入而不是字段注入
   - 避免循環依賴

2. **JDBC 操作多樣性**
   - JdbcTemplate 基本操作
   - SimpleJdbcInsert 便捷插入
   - NamedParameterJdbcTemplate 命名參數
   - 批量操作示例

3. **代碼設計**
   - 使用 Lombok 減少樣板代碼
   - 遵循 Spring 最佳實踐
   - 清晰的職責分離

## 注意事項

- 使用 H2 內存數據庫，應用重啟後數據會重置
- 專案包含示例數據，存儲在 data.sql 中
- 使用 Lombok，請確保 IDE 已安裝 Lombok 插件 