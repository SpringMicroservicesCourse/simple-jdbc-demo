# Spring JDBC 範例專案

這是一個示範如何使用 Spring JDBC 的簡單專案。

## 功能特色

- 使用 Spring JDBC Template 進行資料庫操作
- 展示基本的 CRUD（新增、查詢、更新、刪除）操作
- 包含批次處理範例
- 採用 H2 內存資料庫

## 技術棧

- Java 17
- Spring Boot 3.4.5
- Spring JDBC
- H2 Database
- Lombok
- Maven

## 專案結構

```
src/main/java/tw/fengqing/spring/data/demo/
├── SimpleJdbcDemoApplication.java  # 應用程式入口
├── FooDao.java                     # 基本 JDBC 操作範例
├── BatchFooDao.java                # 批次操作範例
└── Foo.java                       # 資料模型

src/main/resources/
├── schema.sql                     # 資料庫表結構
└── data.sql                       # 初始資料
```

## 重要程式碼說明

### 1. 資料模型 (Foo.java)
```java
@Data
@Builder
public class Foo {
    private Long id;
    private String bar;
}
```

### 2. 基本 JDBC 操作 (FooDao.java)
```java
@Repository
public class FooDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcInsert simpleJdbcInsert;

    // 建構子注入
    public FooDao(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
        this.simpleJdbcInsert = new SimpleJdbcInsert(jdbcTemplate)
                .withTableName("FOO")
                .usingGeneratedKeyColumns("ID");
    }

    // 新增資料範例
    public void insertData() {
        // 使用 JdbcTemplate 新增
        Arrays.asList("b", "c").forEach(bar -> {
            jdbcTemplate.update("INSERT INTO FOO (BAR) VALUES (?)", bar);
        });

        // 使用 SimpleJdbcInsert 新增
        HashMap<String, String> row = new HashMap<>();
        row.put("BAR", "d");
        Number id = simpleJdbcInsert.executeAndReturnKey(row);
    }

    // 查詢資料範例
    public void listData() {
        log.info("資料筆數: {}", 
            jdbcTemplate.queryForObject("SELECT COUNT(*) FROM FOO", Long.class));
    }
}
```

### 3. 批次操作 (BatchFooDao.java)
```java
@Repository
public class BatchFooDao {
    private final JdbcTemplate jdbcTemplate;
    private final NamedParameterJdbcTemplate namedParameterJdbcTemplate;

    // 建構子注入
    public BatchFooDao(JdbcTemplate jdbcTemplate, DataSource dataSource) {
        this.jdbcTemplate = jdbcTemplate;
        this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
    }

    // 批次新增範例
    public void batchInsert() {
        // 使用 BatchPreparedStatementSetter
        jdbcTemplate.batchUpdate("INSERT INTO FOO (BAR) VALUES (?)",
                new BatchPreparedStatementSetter() {
                    @Override
                    public void setValues(PreparedStatement ps, int i) throws SQLException {
                        ps.setString(1, "b-" + i);
                    }

                    @Override
                    public int getBatchSize() {
                        return 2;
                    }
                });

        // 使用 NamedParameterJdbcTemplate
        List<Foo> list = Arrays.asList(
            Foo.builder().id(100L).bar("b-100").build(),
            Foo.builder().id(101L).bar("b-101").build()
        );
        namedParameterJdbcTemplate.batchUpdate(
            "INSERT INTO FOO (ID, BAR) VALUES (:id, :bar)",
            SqlParameterSourceUtils.createBatch(list));
    }
}
```

### 4. 應用程式入口 (SimpleJdbcDemoApplication.java)
```java
@SpringBootApplication
@Slf4j
public class SimpleJdbcDemoApplication implements CommandLineRunner {
    @Autowired
    private FooDao fooDao;
    @Autowired
    private BatchFooDao batchFooDao;

    @Override
    public void run(String... args) throws Exception {
        fooDao.insertData();
        batchFooDao.batchInsert();
        fooDao.listData();
    }
}
```

## 快速開始

1. 確認已安裝 Java 17 與 Maven

2. 下載專案
```bash
git clone https://github.com/SpringMicroservicesCourse/simple-jdbc-demo
cd simple-jdbc-demo
```

3. 執行專案
```bash
mvn spring-boot:run
```

## 主要功能說明

1. 基本 JDBC 操作 (FooDao.java)
   - 新增資料
   - 查詢資料筆數
   - 使用 SimpleJdbcInsert 簡化新增

2. 批次操作 (BatchFooDao.java)
   - 批次新增資料
   - 使用 NamedParameterJdbcTemplate

## 資料庫結構

```sql
CREATE TABLE FOO (
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BAR VARCHAR(64)
);
```

## 程式碼亮點

1. **依賴注入最佳實務**
   - 採用建構子注入，避免欄位注入
   - 避免循環依賴問題

2. **多元 JDBC 操作**
   - JdbcTemplate 基本操作
   - SimpleJdbcInsert 方便插入
   - NamedParameterJdbcTemplate 命名參數
   - 批次操作範例

3. **程式設計**
   - 使用 Lombok 減少樣板程式碼
   - 遵循 Spring 最佳實務
   - 清楚職責分工

## 注意事項

- 使用 H2 內存資料庫，應用程式重啟後資料會清空
- 專案內含範例資料，存放於 data.sql
- 使用 Lombok，請確保 IDE 已安裝 Lombok 外掛

## 授權說明

本專案採用 MIT 授權條款，詳見 LICENSE 檔案。 

## 關於我們

我們主要專注在敏捷專案管理、物聯網（IoT）應用開發和領域驅動設計（DDD）。喜歡把先進技術和實務經驗結合，打造好用又靈活的軟體解決方案。近來也積極結合 AI 技術，推動自動化工作流，讓開發與運維更有效率、更智慧。持續學習與分享，希望能一起推動軟體開發的創新和進步。

## 聯繫我們

若有任何問題、合作或想了解更多，歡迎透過以下管道與我們聯繫：

- FB 粉絲頁：[風清雲談 | Facebook](https://www.facebook.com/profile.php?id=61576838896062)
- LinkedIn：[linkedin.com/in/chu-kuo-lung](https://www.linkedin.com/in/chu-kuo-lung)
- YouTube 頻道：[雲談風清 - YouTube](https://www.youtube.com/channel/UCXDqLTdCMiCJ1j8xGRfwEig)
- 風清雲談 部落格：[風清雲談](https://blog.fengqing.tw/)
- 電子郵件：[fengqing.tw@gmail.com](mailto:fengqing.tw@gmail.com)